/* global L, console, foursq_client_id, foursq_client_secret */(function(){function n(){console.log("showing_markers");console.log(t);$.each(t,function(t,n){console.log(n);e.getBounds().contains(n.getLatLng())?e.addLayer(n):e.removeLayer(n)})}function r(e){var n=new L.marker([e.location.lat,e.location.lng],{title:e.name});t.push(n)}function i(e){console.log("not implemented yet! - showError "+e)}function s(e){i(e)}function o(){console.log("not implemented yet! - onLocationFound")}function u(e){return e*(Math.PI/180)}function a(){var t,n,r,i,s,o,a=e.getCenter(),f=e.getBounds();console.log(a);console.log(f);t=6371;n=u(a.lat-f.getNorthEast.lat);r=u(a.lng-f.getNorthEast.lng);i=Math.sin(n/2)*Math.sin(n/2)+Math.cos(u(a.lat))*Math.cos(u(f.getNorthEast.lat))*Math.sin(r/2)*Math.sin(r/2);s=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i));o=t*s;return o}function f(){var t,i=e.getCenter();console.log(i);t=i.lat+","+i.lng;console.log(a());$.getJSON("https://api.foursquare.com/v2/venues/search",{ll:t,radius:500,limit:50,intent:"checkin",categoryId:"4bf58dd8d48988d155941735,4bf58dd8d48988d11b941735,4d4b7105d754a06376d81259",client_id:foursq_client_id,client_secret:foursq_client_secret,v:20130420}).done(function(e){$.each(e.response.venues,function(e,t){r(t)});n()});n()}function l(){var t="http://{s}.tile.cloudmade.com/364b324514d240c8afdd7ba132fd4841/997/256/{z}/{x}/{y}.png",n="Map data Â© OpenStreetMap contributors",r=new L.TileLayer(t,{minZoom:8,maxZoom:18,attribution:n});e.addLayer(r);e.locate({setView:!0,maxZoom:17});e.on("locationerror",s);e.on("locationfound",o);e.on("moveend",f)}var e=L.map("map"),t=[];l()})();